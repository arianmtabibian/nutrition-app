{"ast":null,"code":"import _objectSpread from\"C:/Users/arian/OneDrive/Desktop/Nutrition/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{createContext,useContext,useState,useEffect}from'react';import{api}from'../services/api';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext(undefined);export const useAuth=()=>{const context=useContext(AuthContext);if(context===undefined){throw new Error('useAuth must be used within an AuthProvider');}return context;};export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);useEffect(()=>{// Check if user is already logged in\nconst token=localStorage.getItem('token');if(token){api.defaults.headers.common['Authorization']=\"Bearer \".concat(token);// Verify token and get user info from the auth verify endpoint\napi.get('/api/auth/verify').then(response=>{console.log('Verify response in AuthContext:',response.data);if(response.data.user){setUser(response.data.user);}}).catch(error=>{console.error('Error verifying user:',error);// Token is invalid, remove it\nlocalStorage.removeItem('token');delete api.defaults.headers.common['Authorization'];}).finally(()=>{setLoading(false);});}else{setLoading(false);}},[]);const login=async(email,password)=>{try{const response=await api.post('/api/auth/login',{email,password});const{token,user:userData}=response.data;localStorage.setItem('token',token);api.defaults.headers.common['Authorization']=\"Bearer \".concat(token);setUser({id:userData.id,email:userData.email,first_name:userData.first_name,last_name:userData.last_name,username:userData.username});}catch(error){var _error$response,_error$response$data;throw new Error(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.error)||'Login failed');}};const register=async(email,password,first_name,last_name,username)=>{try{const response=await api.post('/api/auth/register',{email,password,first_name,last_name,username});const{token,user:userData}=response.data;localStorage.setItem('token',token);api.defaults.headers.common['Authorization']=\"Bearer \".concat(token);setUser({id:userData.id,email:userData.email,first_name:userData.first_name,last_name:userData.last_name,username:userData.username});}catch(error){var _error$response2,_error$response2$data;throw new Error(((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.error)||'Registration failed');}};const logout=()=>{localStorage.removeItem('token');delete api.defaults.headers.common['Authorization'];setUser(null);};const updateUser=userData=>{setUser(prev=>prev?_objectSpread(_objectSpread({},prev),userData):null);};const value={user,loading,login,register,logout,updateUser};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});};","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","api","jsx","_jsx","AuthContext","undefined","useAuth","context","Error","AuthProvider","_ref","children","user","setUser","loading","setLoading","token","localStorage","getItem","defaults","headers","common","concat","get","then","response","console","log","data","catch","error","removeItem","finally","login","email","password","post","userData","setItem","id","first_name","last_name","username","_error$response","_error$response$data","register","_error$response2","_error$response2$data","logout","updateUser","prev","_objectSpread","value","Provider"],"sources":["C:/Users/arian/OneDrive/Desktop/Nutrition/client/src/contexts/AuthContext.tsx"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';\nimport { api } from '../services/api';\n\ninterface User {\n  id: number;\n  email: string;\n  first_name: string;\n  last_name: string;\n  username: string;\n}\n\ninterface AuthContextType {\n  user: User | null;\n  loading: boolean;\n  login: (email: string, password: string) => Promise<void>;\n  register: (email: string, password: string, first_name: string, last_name: string, username: string) => Promise<void>;\n  logout: () => void;\n  updateUser: (userData: Partial<User>) => void;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nexport const useAuth = () => {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n};\n\ninterface AuthProviderProps {\n  children: ReactNode;\n}\n\nexport const AuthProvider: React.FC<AuthProviderProps> = ({ children }) => {\n  const [user, setUser] = useState<User | null>(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    // Check if user is already logged in\n    const token = localStorage.getItem('token');\n    if (token) {\n      api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n      // Verify token and get user info from the auth verify endpoint\n      api.get('/api/auth/verify')\n        .then(response => {\n          console.log('Verify response in AuthContext:', response.data);\n          if (response.data.user) {\n            setUser(response.data.user);\n          }\n        })\n        .catch((error) => {\n          console.error('Error verifying user:', error);\n          // Token is invalid, remove it\n          localStorage.removeItem('token');\n          delete api.defaults.headers.common['Authorization'];\n        })\n        .finally(() => {\n          setLoading(false);\n        });\n    } else {\n      setLoading(false);\n    }\n  }, []);\n\n  const login = async (email: string, password: string) => {\n    try {\n      const response = await api.post('/api/auth/login', { email, password });\n      const { token, user: userData } = response.data;\n      \n      localStorage.setItem('token', token);\n      api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n      \n      setUser({\n        id: userData.id,\n        email: userData.email,\n        first_name: userData.first_name,\n        last_name: userData.last_name,\n        username: userData.username\n      });\n    } catch (error: any) {\n      throw new Error(error.response?.data?.error || 'Login failed');\n    }\n  };\n\n  const register = async (email: string, password: string, first_name: string, last_name: string, username: string) => {\n    try {\n      const response = await api.post('/api/auth/register', { email, password, first_name, last_name, username });\n      const { token, user: userData } = response.data;\n      \n      localStorage.setItem('token', token);\n      api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n      \n      setUser({\n        id: userData.id,\n        email: userData.email,\n        first_name: userData.first_name,\n        last_name: userData.last_name,\n        username: userData.username\n      });\n    } catch (error: any) {\n      throw new Error(error.response?.data?.error || 'Registration failed');\n    }\n  };\n\n  const logout = () => {\n    localStorage.removeItem('token');\n    delete api.defaults.headers.common['Authorization'];\n    setUser(null);\n  };\n\n  const updateUser = (userData: Partial<User>) => {\n    setUser(prev => prev ? { ...prev, ...userData } : null);\n  };\n\n  const value: AuthContextType = {\n    user,\n    loading,\n    login,\n    register,\n    logout,\n    updateUser\n  };\n\n  return (\n    <AuthContext.Provider value={value}>\n      {children}\n    </AuthContext.Provider>\n  );\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}