{"ast":null,"code":"import axios from'axios';// Create axios instance with timeout for better performance\nexport const api=axios.create({baseURL:process.env.REACT_APP_API_URL||'https://nutrition-back-jtf3.onrender.com',timeout:15000,// 15 second timeout - faster startup while still reliable\nheaders:{'Content-Type':'application/json'}});// Request interceptor to add auth token - Use consistent auth system\napi.interceptors.request.use(config=>{// Try to get token from the new auth system first, fallback to old system\nlet token=localStorage.getItem('token');// Check if we have the newer auth data format\nconst authDataStr=localStorage.getItem('nutritrack_auth_data');if(authDataStr){try{const authData=JSON.parse(authDataStr);if(authData.token){token=authData.token;}}catch(error){console.warn('Failed to parse auth data:',error);}}if(token){config.headers.Authorization=\"Bearer \".concat(token);}return config;},error=>{return Promise.reject(error);});// Response interceptor to handle auth errors - More intelligent handling\napi.interceptors.response.use(response=>response,error=>{var _error$response,_error$response2,_error$response3;// Only redirect to login on actual authentication failures, not network issues\nif(((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status)===401||((_error$response2=error.response)===null||_error$response2===void 0?void 0:_error$response2.status)===403){console.log('ðŸ” Authentication failed, clearing auth data and redirecting to login');// Add a small delay to prevent race conditions with multiple API calls\nsetTimeout(()=>{// Clear all auth data using both systems\nlocalStorage.removeItem('token');localStorage.removeItem('user');localStorage.removeItem('domain');localStorage.removeItem('nutritrack_auth_data');// Use React Router navigation instead of hard redirect to prevent 404s\nif(!window.location.pathname.includes('/login')&&!window.location.pathname.includes('/register')){// Dispatch a custom event that the AuthContext can handle\nwindow.dispatchEvent(new CustomEvent('auth-logout'));}},100);// Small delay to prevent race conditions\n}else if(error.code==='ECONNABORTED'||error.message.includes('timeout')){// Network timeout - don't log out, just let the error propagate\nconsole.warn('ðŸŒ Network timeout, keeping user logged in');}else if(((_error$response3=error.response)===null||_error$response3===void 0?void 0:_error$response3.status)>=500){// Server errors shouldn't cause logout\nconsole.warn('ðŸŒ Server error, keeping user logged in');}return Promise.reject(error);});// API endpoints\nexport const authAPI={login:(email,password)=>api.post('/api/auth/login',{email,password}),register:(email,password,first_name,last_name,username)=>api.post('/api/auth/register',{email,password,first_name,last_name,username})};export const profileAPI={get:()=>api.get('/api/profile'),update:data=>api.put('/api/profile',data),calculateCalories:data=>api.post('/api/profile/calculate-calories',data)};export const mealsAPI={add:data=>api.post('/api/meals',data),getByDate:date=>api.get(\"/api/meals/\".concat(date)),getByRange:(startDate,endDate)=>api.get(\"/api/meals/range/\".concat(startDate,\"/\").concat(endDate)),update:(id,data)=>api.put(\"/api/meals/\".concat(id),data),delete:id=>api.delete(\"/api/meals/\".concat(id)),recalculateDailyNutrition:(startDate,endDate)=>api.post('/api/meals/recalculate-daily-nutrition',{startDate,endDate})};export const diaryAPI={getMonth:(year,month)=>api.get(\"/api/diary/\".concat(year,\"/\").concat(month)),getDate:date=>api.get(\"/api/diary/date/\".concat(date)),getWeek:startDate=>api.get(\"/api/diary/week/\".concat(startDate)),getMonthSummary:(year,month)=>api.get(\"/api/diary/month/\".concat(year,\"/\").concat(month,\"/summary\"))};export const favoritesAPI={getAll:()=>api.get('/api/favorites'),create:data=>api.post('/api/favorites',data),createFromMeal:(mealId,customName)=>api.post('/api/favorites/from-meal',{mealId,customName}),update:(id,data)=>api.put(\"/api/favorites/\".concat(id),data),delete:id=>api.delete(\"/api/favorites/\".concat(id))};","map":{"version":3,"names":["axios","api","create","baseURL","process","env","REACT_APP_API_URL","timeout","headers","interceptors","request","use","config","token","localStorage","getItem","authDataStr","authData","JSON","parse","error","console","warn","Authorization","concat","Promise","reject","response","_error$response","_error$response2","_error$response3","status","log","setTimeout","removeItem","window","location","pathname","includes","dispatchEvent","CustomEvent","code","message","authAPI","login","email","password","post","register","first_name","last_name","username","profileAPI","get","update","data","put","calculateCalories","mealsAPI","add","getByDate","date","getByRange","startDate","endDate","id","delete","recalculateDailyNutrition","diaryAPI","getMonth","year","month","getDate","getWeek","getMonthSummary","favoritesAPI","getAll","createFromMeal","mealId","customName"],"sources":["C:/Users/arian/OneDrive/Desktop/Nutrition/client/src/services/api.ts"],"sourcesContent":["import axios from 'axios';\n\n// Create axios instance with timeout for better performance\nexport const api = axios.create({\n  baseURL: process.env.REACT_APP_API_URL || 'https://nutrition-back-jtf3.onrender.com',\n  timeout: 15000, // 15 second timeout - faster startup while still reliable\n  headers: {\n    'Content-Type': 'application/json',\n  },\n});\n\n// Request interceptor to add auth token - Use consistent auth system\napi.interceptors.request.use(\n  (config) => {\n    // Try to get token from the new auth system first, fallback to old system\n    let token = localStorage.getItem('token');\n    \n    // Check if we have the newer auth data format\n    const authDataStr = localStorage.getItem('nutritrack_auth_data');\n    if (authDataStr) {\n      try {\n        const authData = JSON.parse(authDataStr);\n        if (authData.token) {\n          token = authData.token;\n        }\n      } catch (error) {\n        console.warn('Failed to parse auth data:', error);\n      }\n    }\n    \n    if (token) {\n      config.headers.Authorization = `Bearer ${token}`;\n    }\n    return config;\n  },\n  (error) => {\n    return Promise.reject(error);\n  }\n);\n\n// Response interceptor to handle auth errors - More intelligent handling\napi.interceptors.response.use(\n  (response) => response,\n  (error) => {\n    // Only redirect to login on actual authentication failures, not network issues\n    if (error.response?.status === 401 || error.response?.status === 403) {\n      console.log('ðŸ” Authentication failed, clearing auth data and redirecting to login');\n      \n      // Add a small delay to prevent race conditions with multiple API calls\n      setTimeout(() => {\n        // Clear all auth data using both systems\n        localStorage.removeItem('token');\n        localStorage.removeItem('user');\n        localStorage.removeItem('domain');\n        localStorage.removeItem('nutritrack_auth_data');\n        \n        // Use React Router navigation instead of hard redirect to prevent 404s\n        if (!window.location.pathname.includes('/login') && !window.location.pathname.includes('/register')) {\n          // Dispatch a custom event that the AuthContext can handle\n          window.dispatchEvent(new CustomEvent('auth-logout'));\n        }\n      }, 100); // Small delay to prevent race conditions\n    } else if (error.code === 'ECONNABORTED' || error.message.includes('timeout')) {\n      // Network timeout - don't log out, just let the error propagate\n      console.warn('ðŸŒ Network timeout, keeping user logged in');\n    } else if (error.response?.status >= 500) {\n      // Server errors shouldn't cause logout\n      console.warn('ðŸŒ Server error, keeping user logged in');\n    }\n    return Promise.reject(error);\n  }\n);\n\n// API endpoints\nexport const authAPI = {\n  login: (email: string, password: string) => \n    api.post('/api/auth/login', { email, password }),\n  register: (email: string, password: string, first_name: string, last_name: string, username: string) => \n    api.post('/api/auth/register', { email, password, first_name, last_name, username }),\n};\n\nexport const profileAPI = {\n  get: () => api.get('/api/profile'),\n  update: (data: any) => api.put('/api/profile', data),\n  calculateCalories: (data: any) => api.post('/api/profile/calculate-calories', data),\n};\n\nexport const mealsAPI = {\n  add: (data: any) => api.post('/api/meals', data),\n  getByDate: (date: string) => api.get(`/api/meals/${date}`),\n  getByRange: (startDate: string, endDate: string) => \n    api.get(`/api/meals/range/${startDate}/${endDate}`),\n  update: (id: number, data: any) => api.put(`/api/meals/${id}`, data),\n  delete: (id: number) => api.delete(`/api/meals/${id}`),\n  recalculateDailyNutrition: (startDate: string, endDate: string) => \n    api.post('/api/meals/recalculate-daily-nutrition', { startDate, endDate }),\n};\n\nexport const diaryAPI = {\n  getMonth: (year: number, month: number) => \n    api.get(`/api/diary/${year}/${month}`),\n  getDate: (date: string) => api.get(`/api/diary/date/${date}`),\n  getWeek: (startDate: string) => api.get(`/api/diary/week/${startDate}`),\n  getMonthSummary: (year: number, month: number) => \n    api.get(`/api/diary/month/${year}/${month}/summary`),\n};\n\nexport const favoritesAPI = {\n  getAll: () => api.get('/api/favorites'),\n  create: (data: any) => api.post('/api/favorites', data),\n  createFromMeal: (mealId: number, customName?: string) => \n    api.post('/api/favorites/from-meal', { mealId, customName }),\n  update: (id: number, data: any) => api.put(`/api/favorites/${id}`, data),\n  delete: (id: number) => api.delete(`/api/favorites/${id}`),\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}